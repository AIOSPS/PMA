ALTER TABLE `pms`.`pms_incidents`
CHANGE COLUMN `inc_SourceLink` `inc_SourceLink` VARCHAR(150) NULL DEFAULT NULL ;
----------------------
CREATE or replace
    ALGORITHM = UNDEFINED
    DEFINER = `root`@`localhost`
    SQL SECURITY DEFINER
VIEW `pms_water_socio_vw` AS
    SELECT
        `wat`.`wat_id` AS `wat_id`,
        (CASE `wat`.`wat_isconnected`
            WHEN 1 THEN 'Yes'
            ELSE 'No'
        END) AS `wat_isconnected`,
        (CASE `wat`.`wat_network`
            WHEN 1 THEN 'Yes'
            WHEN 2 THEN 'No'
            ELSE 'Partially'
        END) AS `wat_network`,
        (CASE `wat`.`wat_use_wat_tanker`
            WHEN 1 THEN 'Yes'
            ELSE 'No'
        END) AS `wat_use_wat_tanker`,
        `wat`.`wat_rain_water_well` AS `wat_rain_water_well`,
        `wat`.`wat_no_springs` AS `wat_no_springs`,
        `wat`.`wat_price_water` AS `wat_price_water`,
        (CASE `wat`.`wat_filling_point`
            WHEN 1 THEN 'Within 5KM'
            ELSE 'Beyond 5KM'
        END) AS `wat_filling_point`,
        `wat`.`wat_quantity` AS `wat_quantity`,
        `wat`.`wat_survey_date` AS `wat_survey_date`,
        `wat`.`username` AS `username`,
        `wat`.`time_stamp` AS `time_stamp`,
        `wat`.`com_id` AS `com_id`,
        `com`.`com_name` AS `com_name`,
        `gov`.`gov_id` AS `gov_id`,
        `gov`.`gov_desc` AS `gov_desc`
    FROM
        ((`pms_water_socio` `wat`
        JOIN `pms_communities` `com`)
        JOIN `pms_governates` `gov`)
    WHERE
        ((`wat`.`com_id` = `com`.`com_id`)
            AND (`com`.`gov_id` = `gov`.`gov_id`))
------------------------------------
ALTER TABLE `pms`.`pms_master_plan`
CHANGE COLUMN `mas_mp_no` `mas_mp_no` VARCHAR(15) NULL ,
CHANGE COLUMN `mas_last_submit_date_to_ica` `mas_last_submit_date_to_ica` DATE NULL ,
CHANGE COLUMN `mas_approval_date` `mas_approval_date` DATE NULL ,
CHANGE COLUMN `mas_publication_date` `mas_publication_date` DATE NULL ,
CHANGE COLUMN `mas_last_date_for_objection` `mas_last_date_for_objection` DATE NULL ,
CHANGE COLUMN `mas_date_of_final_publication` `mas_date_of_final_publication` DATE NULL ,
CHANGE COLUMN `mas_approved_planed_area` `mas_approved_planed_area` INT(11) NULL COMMENT 'Approved planned area (Donum)' ;


USE `pms`;
CREATE
     OR REPLACE ALGORITHM = UNDEFINED
    DEFINER = `root`@`localhost`
    SQL SECURITY DEFINER
VIEW `pms_master_plan_vw` AS
    SELECT
        `mp`.`mas_id` AS `mas_id`,
        `mp`.`mas_mp_no` AS `mas_mp_no`,
        `mp`.`mas_mp_name` AS `mas_mp_name`,
        `mp`.`mas_status` AS `mas_status`,
        `mp`.`mas_status_ica` AS `mas_status_ica`,
        `mp`.`mas_first_submit_date_to_ica` AS `mas_first_submit_date_to_ica`,
        `mp`.`mas_last_submit_date_to_ica` AS `mas_last_submit_date_to_ica`,
        `mp`.`mas_no_session_with_ica` AS `mas_no_session_with_ica`,
        `mp`.`mas_submit_to_mod` AS `mas_submit_to_mod`,
        `mp`.`mas_approval_date` AS `mas_approval_date`,
        `mp`.`mas_publication_date` AS `mas_publication_date`,
        `mp`.`mas_last_date_for_objection` AS `mas_last_date_for_objection`,
        `mp`.`mas_date_of_final_publication` AS `mas_date_of_final_publication`,
        `mp`.`mas_approved_planed_area` AS `mas_approved_planed_area`,
        `mp`.`mas_village_admin_boarder` AS `mas_village_admin_boarder`,
        `mp`.`mas_note` AS `mas_note`,
        `mp`.`imp_id` AS `imp_id`,
        `mp`.`username` AS `username`,
        `mp`.`time_stamp` AS `time_stamp`,
        `mpc`.`com_id` AS `com_id`,
        `com`.`com_name` AS `com_name`
    FROM
        ((`pms_master_plan` `mp`
        left JOIN `pms_master_plan_communities` `mpc` on  (`mp`.`mas_id` = `mpc`.`mas_id`))
        left JOIN `pms_communities` `com` ON ((`mpc`.`com_id` = `com`.`com_id`)));
---------------
drop TABLE if exists `pms_economic_socio` ;
CREATE TABLE `pms_economic_socio` (
  `eco_id` varchar(15) NOT NULL,
  `com_id` varchar(15) NOT NULL,
  `men_livelihood_source1` char(1) NOT NULL COMMENT 'Domain of values (work in settlements, PA employee, Farming, Handicrafts )',
  `men_livelihood_source2` char(1) NOT NULL COMMENT 'Domain of values (work in settlements, PA employee, Farming, Handicrafts )',
  `men_livelihood_source3` char(1) NOT NULL COMMENT 'Domain of values (work in settlements, PA employee, Farming, Handicrafts )',
  `women_livelihood_source1` char(1) NOT NULL COMMENT 'Domain of values (work in settlements, PA employee, Farming, Handicrafts )',
  `women_livelihood_source2` char(1) NOT NULL COMMENT 'Domain of values (work in settlements, PA employee, Farming, Handicrafts )',
  `women_livelihood_source3` char(1) NOT NULL COMMENT 'Domain of values (work in settlements, PA employee, Farming, Handicrafts )',
  `access_to_lands_military` char(1) NOT NULL COMMENT 'Yes or No',
  `access_to_lands_checkpoints` char(1) NOT NULL COMMENT 'Yes or No',
  `family_avg_size` int(11) NOT NULL,
  `family_avg_income` decimal(5,3) NOT NULL,
  `username` varchar(15) NOT NULL,
  `time_stamp` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`com_id`,`eco_id`),
  CONSTRAINT `pms_econmic_socio_pms_com_fk` FOREIGN KEY (`com_id`) REFERENCES `pms_communities` (`com_id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
------------------------
CREATE
    ALGORITHM = UNDEFINED
    DEFINER = `root`@`localhost`
    SQL SECURITY DEFINER
VIEW `pms_economic_socio_vw` AS
    SELECT
        `pms_economic_socio`.`eco_id` AS `eco_id`,
        `pms_economic_socio`.`com_id` AS `com_id`,
        (CASE `pms_economic_socio`.`men_livelihood_source1`
            WHEN 1 THEN 'work in settlements'
            WHEN 2 THEN 'PA employee'
            WHEN 3 THEN 'Farming'
            WHEN 4 THEN 'Handicrafts'
            ELSE 'N/A'
        END) AS `men_livelihood_source1`,
        (CASE `pms_economic_socio`.`men_livelihood_source2`
            WHEN 1 THEN 'work in settlements'
            WHEN 2 THEN 'PA employee'
            WHEN 3 THEN 'Farming'
            WHEN 4 THEN 'Handicrafts'
            ELSE 'N/A'
        END) AS `men_livelihood_source2`,
        (CASE `pms_economic_socio`.`men_livelihood_source3`
            WHEN 1 THEN 'work in settlements'
            WHEN 2 THEN 'PA employee'
            WHEN 3 THEN 'Farming'
            WHEN 4 THEN 'Handicrafts'
            ELSE 'N/A'
        END) AS `men_livelihood_source3`,
        (CASE `pms_economic_socio`.`women_livelihood_source1`
            WHEN 1 THEN 'work in settlements'
            WHEN 2 THEN 'PA employee'
            WHEN 3 THEN 'Farming'
            WHEN 4 THEN 'Handicrafts'
            ELSE 'N/A'
        END) AS `women_livelihood_source1`,
        (CASE `pms_economic_socio`.`women_livelihood_source2`
            WHEN 1 THEN 'work in settlements'
            WHEN 2 THEN 'PA employee'
            WHEN 3 THEN 'Farming'
            WHEN 4 THEN 'Handicrafts'
            ELSE 'N/A'
        END) AS `women_livelihood_source2`,
        (CASE `pms_economic_socio`.`women_livelihood_source3`
            WHEN 1 THEN 'work in settlements'
            WHEN 2 THEN 'PA employee'
            WHEN 3 THEN 'Farming'
            WHEN 4 THEN 'Handicrafts'
            ELSE 'N/A'
        END) AS `women_livelihood_source3`,
        (CASE `pms_economic_socio`.`access_to_lands_military`
            WHEN 1 THEN 'Yes'
            WHEN 0 THEN 'No'
            ELSE 'N/A'
        END) AS `access_to_lands_military`,
        (CASE `pms_economic_socio`.`access_to_lands_checkpoints`
            WHEN 1 THEN 'Yes'
            WHEN 0 THEN 'No'
            ELSE 'N/A'
        END) AS `access_to_lands_checkpoints`,
        `pms_economic_socio`.`family_avg_size` AS `family_avg_size`,
        `pms_economic_socio`.`family_avg_income` AS `family_avg_income`,
        `pms_economic_socio`.`username` AS `username`,
        `pms_economic_socio`.`time_stamp` AS `time_stamp`
    FROM
        `pms_economic_socio`
--------------------------------
CREATE
    ALGORITHM = UNDEFINED
    DEFINER = `root`@`localhost`
    SQL SECURITY DEFINER
VIEW `pms_incidents_communities_vw` AS
    SELECT
        `inc`.`inc_id` AS `inc_id`,
        `inc`.`inc_type` AS `inc_type`,
        `inc`.`inc_ocha_id` AS `inc_ocha_id`,
        `inc`.`inc_description` AS `inc_description`,
        `inc`.`inc_Affected_women` AS `inc_Affected_women`,
        `inc`.`inc_Affected_men` AS `inc_Affected_men`,
        `inc`.`inc_Affected_adaults` AS `inc_Affected_adaults`,
        `inc`.`inc_Affected_children` AS `inc_Affected_children`,
        `inc`.`inc_Displaced_women` AS `inc_Displaced_women`,
        `inc`.`inc_SourceLink` AS `inc_SourceLink`,
        `inc`.`inc_timeStamp` AS `inc_timeStamp`,
        `inc`.`dat_id` AS `dat_id`,
        `inc`.`com_id` AS `com_id`,
        `inc`.`ocha_loc_latitude` AS `ocha_loc_latitude`,
        `inc`.`ocha_loc_longitude` AS `ocha_loc_longitude`,
        `inc`.`pro_id` AS `pro_id`,
        `inc`.`inc_Displaced_men` AS `inc_Displaced_men`,
        `inc`.`inc_Displaced_adult` AS `inc_Displaced_adult`,
        `inc`.`inc_Displaced_children` AS `inc_Displaced_children`,
        `inc`.`inc_loc_latitude` AS `inc_loc_latitude`,
        `inc`.`inc_loc_longitude` AS `inc_loc_longitude`,
        `inc`.`inc_demolished_structure` AS `inc_demolished_structure`,
        `inc`.`username` AS `username`,
        `inc`.`time_stamp` AS `time_stamp`,
        `com`.`gov_id` AS `gov_id`
    FROM
        (`pms_incidents` `inc`
        JOIN `pms_communities` `com`)
    WHERE
        (`inc`.`com_id` = `com`.`com_id`)
---------------------------------------------------
CREATE
    ALGORITHM = UNDEFINED
    DEFINER = `root`@`localhost`
    SQL SECURITY DEFINER
VIEW `pms_communities_vw` AS
    SELECT
        `com`.`com_id` AS `com_id`,
        `com`.`com_name` AS `com_full_name`,
        `comtyp`.`typ_desc` AS `typ_desc`,
        `gov`.`gov_desc` AS `gov_desc`,
        `com`.`com_pcbs_code` AS `com_pcbs_code`,
        `com`.`com_ocha_code` AS `com_ocha_code`,
        `com`.`gov_id` AS `gov_id`,
        `com`.`com_topology` AS `com_topology`,
        CONCAT(`com`.`com_name`, '-', `gov`.`gov_desc`) AS `com_name`
    FROM
        ((`pms_communities` `com`
        JOIN `pms_community_types` `comtyp`)
        JOIN `pms_governates` `gov`)
    WHERE
        ((`com`.`typ_id` = `comtyp`.`typ_id`)
            AND (`com`.`gov_id` = `gov`.`gov_id`))
--------------------------
ALTER TABLE `pms`.`pms_master_plan`
ADD COLUMN `mas_major_objection` VARCHAR(100) NULL AFTER `mas_status_ica`;
--------------------------
ALTER TABLE `pms`.`pms_projects`
ADD COLUMN `subsec_id` VARCHAR(15) NULL AFTER `sec_id`;
